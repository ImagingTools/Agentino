#!/bin/sh

echo "Running post-merge hook..."

REPO_ROOT="$(pwd)"

# Detect OS and choose appropriate script
if [ "$(uname -s)" = "Linux" ] || [ "$(uname -s)" = "Darwin" ]; then
    # macOS/Linux - use shell script
    SCRIPT="$REPO_ROOT/Build/Git/UpdateVersion.sh"
    echo "Looking for: $SCRIPT"
    
    if [ -f "$SCRIPT" ]; then
        echo "Executing $SCRIPT..."
        cd "$REPO_ROOT"
        "$SCRIPT"
    else
        echo "Error: $SCRIPT not found"
        echo "Checking Build/Git directory:"
        ls -la "Build/Git/" 2>/dev/null || echo "Directory Build/Git does not exist"
        exit 1
    fi
else
    # Windows - use batch file
    BAT_FILE="$REPO_ROOT/Build/Git/UpdateVersion.bat"
    echo "Looking for: $BAT_FILE"
    
    if [ -f "$BAT_FILE" ]; then
        echo "Executing $BAT_FILE..."
        cd "$REPO_ROOT"
        cmd //c "$BAT_FILE"
    else
        echo "Error: $BAT_FILE not found"
        echo "Checking Build/Git directory:"
        ls -la "Build/Git/" 2>/dev/null || echo "Directory Build/Git does not exist"
        exit 1
    fi
fi

echo "Post-merge hook completed"