schema {
	query: Query
	mutation: Mutation
	subscription: Subscription
	name: Services
	namespace: agentino
	version: 1.0
}

import {
	"../../../../ImtCore/Sdl/imtbase/1.0/ImtCollection.sdl"
}

type ServiceListInputViewParams {
	count: Int
	offset: Int
	filterModel: String
}

input ServiceListInput {
	viewParams: ServiceListInputViewParams
}

type ServiceItem {
	id: ID!
	typeId: ID!
	name: String!
	description: String
	path: String
	status: String
	version: String
}

type ServiceListPayload{
	items: [ServiceItem]!
}

type UrlParameter {
	host: String
	port: Integer
	scheme: String
}

type ExternPort {
	id: ID
	name: String
	description: String
	url: UrlParameter
}

type InputConnection {
	id: ID
	usageId: String
	connectionName: String
	description: String
	serviceName: String
	serviceTypeName: String
	externPorts: [ExternPort]
	url: UrlParameter
}

type Element {
	id: ID
	name: String
	url: UrlParameter
}

type OutputConnection {
	id: ID
	usageId: String
	connectionName: String
	description: String
	serviceName: String
	serviceTypeName: String
	dependantConnectionId: String
	elements: [Element]
	url: UrlParameter
}

type ServiceData {
	id: ID!
	name: String!
	description: String
	path: String
	arguments: String
	serviceTypeName: String
	enableVerbose: Boolean
	isAutoStart: Boolean
	tracingLevel: Integer
	startScript: String
	stopScript: String
	version: String
	status: String
	inputConnections: [InputConnection]
	outputConnections: [OutputConnection]
}

input ServiceDataInput {
	id: ID!
	item: ServiceData!
}

input ConnectionUrlInput {
	serviceId: ID!
	connectionId: ID!
	url: UrlParameter!
}

type UpdateConnectionUrlResponse {
	succesful: Boolean
}

enum ServiceStatus {
	UNDEFINED
	STARTING
	STOPPING
	RUNNING
	NOT_RUNNING
	RUNNING_IMPOSSIBLE
}

type ServiceInput {
	serviceId: ID!
}

type ServiceStatusResponse {
	status: ServiceStatus!
}

type Query {
	ServicesList (input: ServiceListInput): ServiceListPayload!
	GetService (input: InputId): ServiceData!
	GetServiceStatus (input: InputId): ServiceStatusResponse!
}

type Mutation {
	UpdateService (input: ServiceDataInput): UpdatedNotificationPayload!
	AddService (input: ServiceDataInput): AddedNotificationPayload!
	
	StartService (input: ServiceInput): ServiceStatusResponse!
	StopService (input: ServiceInput): ServiceStatusResponse!
	
	ServicesRemove (input: RemoveElementsInput): RemovedNotificationPayload!
	UpdateConnectionUrl (input: ConnectionUrlInput): UpdateConnectionUrlResponse!
}

collectionSchema {
	type Service {
		ref: ServiceItem
		operations {
			list: ServicesList
		}
		subtype Service {
			ref: ServiceData
			operations {
				get: GetService
				update: UpdateService
				insert: AddService
			}
		}
	}
}
